// <autogenerated>
//   This file was generated by dddappp code generator.
//   Any changes made to this file manually will be lost next time the file is regenerated.
// </autogenerated>

package org.test.aptosformsdemo.aptos.contract.service;


import com.github.wubuku.aptos.bean.AccountResource;
import com.github.wubuku.aptos.utils.*;
import org.test.aptosformsdemo.aptos.contract.ContractConstants;
import org.test.aptosformsdemo.aptos.contract.DomainBeanUtils;
import org.test.aptosformsdemo.domain.aptosformsdemoglobal.*;
import org.test.aptosformsdemo.domain.*;
import org.test.aptosformsdemo.aptos.contract.AptosFormsDemoGlobal;
import org.test.aptosformsdemo.aptos.contract.ContractModuleNameProvider;

import java.io.IOException;
import java.math.*;
import java.util.*;
import java.util.function.*;


public class AptosAptosFormsDemoGlobalStateRetriever {

    private NodeApiClient aptosNodeApiClient;

    private BiFunction<String, java.util.function.Function<String, FormAndAddress>, AptosFormsDemoGlobalState.MutableAptosFormsDemoGlobalState> aptosFormsDemoGlobalStateFactory;


    public AptosAptosFormsDemoGlobalStateRetriever(NodeApiClient aptosNodeApiClient,
                                    BiFunction<String, java.util.function.Function<String, FormAndAddress>, AptosFormsDemoGlobalState.MutableAptosFormsDemoGlobalState> aptosFormsDemoGlobalStateFactory
    ) {
        this.aptosNodeApiClient = aptosNodeApiClient;
        this.aptosFormsDemoGlobalStateFactory = aptosFormsDemoGlobalStateFactory;
    }

    public AptosFormsDemoGlobalState retrieveAptosFormsDemoGlobalState(ContractModuleNameProvider contractModuleNameProvider, java.util.function.Function<String, FormAndAddress> toFormAndAddress, String accountAddress) {
        String resourceAccountAddress = contractModuleNameProvider.getStoreAccountAddress();
        AccountResource<AptosFormsDemoGlobal> accountResource;
        try {
            accountResource = aptosNodeApiClient.getAccountResource(resourceAccountAddress,
                    contractModuleNameProvider.getContractAddress() + "::" + contractModuleNameProvider.getModuleQualifiedEntityStateStructName(),
                    AptosFormsDemoGlobal.class,
                    null);
        } catch (IOException e) {
            throw new RuntimeException(e);
        }
        AptosFormsDemoGlobal aptosFormsDemoGlobal = accountResource.getData();
        aptosFormsDemoGlobal.setAccountAddress(resourceAccountAddress);
        return toAptosFormsDemoGlobalState(toFormAndAddress, aptosFormsDemoGlobal);
    }

    private AptosFormsDemoGlobalState toAptosFormsDemoGlobalState(java.util.function.Function<String, FormAndAddress> toFormAndAddress, AptosFormsDemoGlobal aptosFormsDemoGlobal) {
        AptosFormsDemoGlobalState.MutableAptosFormsDemoGlobalState aptosFormsDemoGlobalState = aptosFormsDemoGlobalStateFactory.apply(aptosFormsDemoGlobal.getAccountAddress(), toFormAndAddress);
        aptosFormsDemoGlobalState.setVersion(aptosFormsDemoGlobal.getVersion());
        aptosFormsDemoGlobalState.setDynamicProperties(aptosFormsDemoGlobal.getDynamicProperties());
        return aptosFormsDemoGlobalState;
    }

}

